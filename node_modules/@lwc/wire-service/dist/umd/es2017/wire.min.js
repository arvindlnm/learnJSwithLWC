!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WireService={})}(this,function(e){"use strict";const t="@wire",n="updated",i="connected",r="disconnected",s="connect",c="disconnect",o="config";function a(e,t,n){n.mutated||(n.mutated=new Set,Promise.resolve().then(function(e,t){const n=new Set,i=t.mutated;delete t.mutated,i.forEach(i=>{const r=function(e,t){let n=e[t.head];if(!t.tail)return n;const i=t.tail;for(let e=0,t=i.length;e<t&&null!=n;e++){const t=i[e];if("object"!=typeof n||!(t in n))return;n=n[t]}return n}(e,i);if(t.values[i.reference]===r)return;t.values[i.reference]=r;const s=t.listeners[i.head];for(let e=0,t=s.length;e<t;e++)n.add(s[e])}),r=n,s=t.values,r.forEach(e=>{const{listener:t,statics:n,reactives:i}=e,r=Object.create(null);if(i){const e=Object.keys(i);for(let t=0,n=e.length;t<n;t++){const n=e[t],c=s[i[n]];r[n]=c}}const c=Object.assign({},n,r);t.call(void 0,c)});var r,s}.bind(void 0,e,n))),n.mutated.add(t)}function l(e,t,n){const i=a.bind(void 0,e,t,n),r=function(e,t,n){const i=function e(t,n,i){i=i||[];if(!t||i.indexOf(t)>-1)return null;const r=Object.getOwnPropertyDescriptor(t,n);if(r)return r;const s=Object.getPrototypeOf(t);if(!s)return null;i.push(t);return e(s,n,i)}(e,t);let r,s,c;if(null===i||void 0===i.get&&void 0===i.set){let i=e[t];r=!0,s=function(){return i},c=function(e){i=e,n()}}else{const{set:t,get:o}=i;r=i.enumerable,c=function(i){t&&t.call(e,i),n()},s=function(){return o?o.call(e):void 0}}return{set:c,get:s,enumerable:r,configurable:!0}}(e,t.head,i);Object.defineProperty(e,t.head,r)}function u(e,t){const n=e.indexOf(t);n>-1&&e.splice(n,1)}function d(e){if(!e.includes("."))return{reference:e,head:e};const t=e.split(".");return{reference:e,head:t.shift(),tail:t}}class f{constructor(e,t,n,i,r){this._cmp=e,this._def=t,this._context=n,this._wireDef=i,this._wireTarget=r}addEventListener(e,u){switch(e){case s:this._context[t][i].push(u);break;case c:this._context[t][r].push(u);break;case o:{const e=this._wireDef.params,i=this._wireDef.static;let r;if(!e||0===(r=Object.keys(e)).length){const e=i||Object.create(null);return void u.call(void 0,e)}const s={listener:u,statics:i,reactives:e},c=this._context[t][n];r.forEach(t=>{const n=d(e[t]);let i=c.listeners[n.head];i?i.push(s):(i=[s],c.listeners[n.head]=i,l(this._cmp,n,c)),a(this._cmp,n,c)});break}default:throw new Error(`unsupported event type ${e}`)}}removeEventListener(e,a){switch(e){case s:u(this._context[t][i],a);break;case c:u(this._context[t][r],a);break;case o:{const e=this._context[t][n].listeners,i=this._wireDef.params;i&&Object.keys(i).forEach(t=>{const n=d(i[t]),r=e[n.head];r&&function(e,t){for(let n=0,i=e.length;n<i;n++)if(e[n].listener===t)return void e.splice(n,1)}(r,a)});break}default:throw new Error(`unsupported event type ${e}`)}}dispatchEvent(e){if(e instanceof h){const t=e.value;return this._wireDef.method?this._cmp[this._wireTarget](t):this._cmp[this._wireTarget]=t,!1}if("WireContextEvent"===e.type)return this._cmp.dispatchEvent(e);throw new Error(`Invalid event ${e}.`)}}class h{constructor(e){this.type="ValueChangedEvent",this.value=e}}const v=new Map;function p(e){for(let t=0,n=e.length;t<n;++t)e[t].call(void 0)}const b={wiring:(e,s,c,o)=>{const a=o[t]=Object.create(null);a[i]=[],a[r]=[],a[n]={listeners:{},values:{}};const l=c.wire,u=Object.keys(l);for(let t=0,n=u.length;t<n;t++){const n=u[t],i=l[n],r=v.get(i.adapter);if(r){const t=new f(e,c,o,i,n);r({dispatchEvent:t.dispatchEvent.bind(t),addEventListener:t.addEventListener.bind(t),removeEventListener:t.removeEventListener.bind(t)})}}},connected:(e,n,r,s)=>{let c;r.wire&&(c=s[t][i])&&p(c)},disconnected:(e,n,i,s)=>{let c;i.wire&&(c=s[t][r])&&p(c)}};e.ValueChangedEvent=h,e.register=function(e,t){v.set(e,t)},e.registerWireService=function(e){e(b)},Object.defineProperty(e,"__esModule",{value:!0})});
