!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e=e||self).WireService={})}(this,function(e){"use strict";function t(e,t,n){n.mutated||(n.mutated=new Set,Promise.resolve().then(function(e,t){var n=new Set,r=t.mutated;delete t.mutated,r.forEach(function(r){var i=function(e,t){var n=e[t.head];if(!t.tail)return n;for(var r=t.tail,i=0,c=r.length;i<c&&null!=n;i++){var a=r[i];if("object"!=typeof n||!(a in n))return;n=n[a]}return n}(e,r);if(t.values[r.reference]!==i){t.values[r.reference]=i;for(var c=t.listeners[r.head],a=0,o=c.length;a<o;a++)n.add(c[a])}}),i=n,c=t.values,i.forEach(function(e){var t=e.listener,n=e.statics,r=e.reactives,i=Object.create(null);if(r)for(var a=Object.keys(r),o=0,s=a.length;o<s;o++){var u=a[o],d=c[r[u]];i[u]=d}var f=Object.assign({},n,i);t.call(void 0,f)});var i,c}.bind(void 0,e,n))),n.mutated.add(t)}function n(e,n,r){var i=t.bind(void 0,e,n,r),c=function(e,t,n){var r,i,c,a=function e(t,n,r){r=r||[];if(!t||r.indexOf(t)>-1)return null;var i=Object.getOwnPropertyDescriptor(t,n);if(i)return i;var c=Object.getPrototypeOf(t);if(!c)return null;r.push(t);return e(c,n,r)}(e,t);if(null===a||void 0===a.get&&void 0===a.set){var o=e[t];r=!0,i=function(){return o},c=function(e){o=e,n()}}else{var s=a.set,u=a.get;r=a.enumerable,c=function(t){s&&s.call(e,t),n()},i=function(){return u?u.call(e):void 0}}return{set:c,get:i,enumerable:r,configurable:!0}}(e,n.head,i);Object.defineProperty(e,n.head,c)}function r(e,t){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function i(e){if(!e.includes("."))return{reference:e,head:e};var t=e.split(".");return{reference:e,head:t.shift(),tail:t}}var c=function(){function e(e,t,n,r,i){this._cmp=e,this._def=t,this._context=n,this._wireDef=r,this._wireTarget=i}return e.prototype.addEventListener=function(e,r){var c=this;switch(e){case"connect":this._context["@wire"].connected.push(r);break;case"disconnect":this._context["@wire"].disconnected.push(r);break;case"config":var a=this._wireDef.params,o=this._wireDef.static,s=void 0;if(!a||0===(s=Object.keys(a)).length){var u=o||Object.create(null);return void r.call(void 0,u)}var d={listener:r,statics:o,reactives:a},f=this._context["@wire"].updated;s.forEach(function(e){var r=i(a[e]),o=f.listeners[r.head];o?o.push(d):(o=[d],f.listeners[r.head]=o,n(c._cmp,r,f)),t(c._cmp,r,f)});break;default:throw new Error("unsupported event type "+e)}},e.prototype.removeEventListener=function(e,t){switch(e){case"connect":r(this._context["@wire"].connected,t);break;case"disconnect":r(this._context["@wire"].disconnected,t);break;case"config":var n=this._context["@wire"].updated.listeners,c=this._wireDef.params;c&&Object.keys(c).forEach(function(e){var r=i(c[e]),a=n[r.head];a&&function(e,t){for(var n=0,r=e.length;n<r;n++)if(e[n].listener===t)return void e.splice(n,1)}(a,t)});break;default:throw new Error("unsupported event type "+e)}},e.prototype.dispatchEvent=function(e){if(e instanceof a){var t=e.value;return this._wireDef.method?this._cmp[this._wireTarget](t):this._cmp[this._wireTarget]=t,!1}if("WireContextEvent"===e.type)return this._cmp.dispatchEvent(e);throw new Error("Invalid event "+e+".")},e}(),a=function(){return function(e){this.type="ValueChangedEvent",this.value=e}}(),o=new Map;function s(e){for(var t=0,n=e.length;t<n;++t)e[t].call(void 0)}var u={wiring:function(e,t,n,r){var i=r["@wire"]=Object.create(null);i.connected=[],i.disconnected=[],i.updated={listeners:{},values:{}};for(var a=n.wire,s=Object.keys(a),u=function(t,i){var u=s[t],d=a[u],f=o.get(d.adapter);if(f){var v=new c(e,n,r,d,u);f({dispatchEvent:v.dispatchEvent.bind(v),addEventListener:v.addEventListener.bind(v),removeEventListener:v.removeEventListener.bind(v)})}},d=0,f=s.length;d<f;d++)u(d)},connected:function(e,t,n,r){var i;n.wire&&(i=r["@wire"].connected)&&s(i)},disconnected:function(e,t,n,r){var i;n.wire&&(i=r["@wire"].disconnected)&&s(i)}};e.ValueChangedEvent=a,e.register=function(e,t){o.set(e,t)},e.registerWireService=function(e){e(u)},Object.defineProperty(e,"__esModule",{value:!0})});
